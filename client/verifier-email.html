<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
     <div id="message-container">
        <h1>Vérification de votre email</h1>
        <p id="status-message">Vérification en cours...</p>
    </div>

    <script>
        // verification-email.js
document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const token = urlParams.get('token');
    if (!token) return;
    if(localStorage.getItem('role')=="attenteR"){
        verifierTokenEmail(token);
    } else {
        location.assign('http://localhost:5500/client')
    }
    
});

async function verifierTokenEmail(token) {
    try {
        const reponse = await fetch('http://localhost:3000/verifier-email', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ token })
        });

        const data = await reponse.json();
        
        if (data.success) {
            // 1- afficherSucces('Votre email a été vérifié avec succès !');
            // 2- logique: s'il a déjà utilisé le lien de l'émail.
            localStorage.setItem('role', 'registred')
            localStorage.setItem('token', data.token)
            const {nom, prenom, email, tel, freeMins} = data.eleveUpdated
            const objElv={nom, prenom, email, tel, freeMins}
            
            
            localStorage.setItem('profile', JSON.stringify(objElv))

            location.assign('http://localhost:5500/client/index.html')
            
        } else {
            localStorage.setItem('role', '')
            // afficher message de durée de 3 secondes
          
            location.assign('http://localhost:5500/client/index.html')
        }
    } catch (erreur) {
        console.log(erreur);
    }
}


    </script>
</body>
</html>